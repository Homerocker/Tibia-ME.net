<?php/** * @author Molodoy <molodoy3561@gmail.com> * @copyright (c) 2014, Tibia-ME.net */class geo {    public static function update_database() {        $status = true;        foreach (array_keys(LOCALES) as $lang) {            $data = curl_get_contents('https://raw.githubusercontent.com/umpirsky/country-list/master/data/' . $lang . '/country.json');            if (!($data = json_decode($data, true))) {                $status = false;                continue;            }            file_put_contents($_SERVER['DOCUMENT_ROOT'] . '/../locale/' . $lang . '/geo.dat', serialize($data), LOCK_EX);        }        return $status;    }    public static function getCountries($cid = null) {        $countries = unserialize(                file_get_contents(                        self::get_path()                )        );        return $cid === null ? $countries : ($countries[$cid] ?? $cid);    }    public static function country_exists($cid) {        return array_key_exists($cid, unserialize(file_get_contents(self::get_path())));    }    private static function get_path() {        return __DIR__ . '/../locale/'                . (($_SESSION['locale'] === DEFAULT_LOCALE || !file_exists(                        __DIR__ . '/../locale/' . $_SESSION['locale'] . '/geo.dat'                )) ? DEFAULT_LOCALE : $_SESSION['locale']) . '/geo.dat';    }    public static function searchCountry($query, $strict = false) {        $results = array();        foreach (array_keys(LOCALES) as $locale) {            $countries = unserialize(file_get_contents(__DIR__ . '/../locale/' . $locale . '/geo.dat'));            $countries = array_filter($countries, function($el) use ($query, $strict) {                if ($strict) {                    return mb_strtolower($el) === mb_strtolower($query);                }                return ( stripos($el, $query) !== false );            });            foreach ($countries as $id => $location) {                $results[] = array(                    'id' => $id,                    'location' => $location,                    'locale' => $locale                );            }        }        return $results;    }}